{% extends "base.html" %}{% block csscontent %}   <link href="{{ static('plugins/datatables/extensions/Responsive/css/dataTables.responsive.css') }}" rel="stylesheet">    <link href="{{ static('plugins/datatables/extensions/TableTools/css/dataTables.tableTools.css') }}" rel="stylesheet">    <link href="{{ static('plugins/datatables/dataTables.bootstrap.css') }}" rel="stylesheet"><link href="{{ static('lib/css/select2.min.css') }}" rel="stylesheet">{% endblock %}{% block content %}{% set messages = get_messages(request) %}{% if messages %}    <div class="alert alert-success alert-dismissable">        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>        {{ messages|join('|') }}    </div>{% endif %}{% block search_module %}    {% block navigation_module %}<section class="content-header">  <h1>	{{title}}	<small>{{title}}</small>  </h1>  <ol class="breadcrumb">	<li><a href="#"><i class="fa fa-dashboard"></i> {{title}}</a></li>	<li class="active">{{title}}</li>  </ol></section>    {% endblock navigation_module %}<div class="panel panel-default">    <div class="panel-body">        <div class="form-horizontal gm-form-horizontal">            {% block searchbar %}            <div class="form-group gm-search-heading">                <div class="col-sm-4">                    <div class="input-group">                        <input type="text" class="form-control" name="srch_value" placeholder="" onkeypress="if(event.keyCode==13) {search_click();return false;}">                        <span class="input-group-btn">                            <button class="btn btn-default" type="button" id="id-search-btn">查询</button>                        </span>                    </div>                </div>                <div class="col-sm-6">                    {% for opt, name in qry_items %}                    <label class="radio-inline">                        <input type="radio" name="srch_field" value="{{ opt }}" {% if loop.first %} checked="checked"{% endif %}/> {{ name }}                    </label>                    {% endfor %}                </div>                {% block show_more_filter -%}                <div class="col-sm-2 dropdown">                    <a data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample">                        过滤器                        <span class="caret"></span>                    </a>                </div>                {%- endblock %}            </div>            {% endblock searchbar %}            <div class="gm-search-body collapse" id="collapseExample">                {% block more_filter -%}                {%- endblock more_filter %}            </div>        </div>    </div></div>{% endblock search_module %}{% block list_body %}<div class="row">    <div class="col-lg-12">        <div class="panel panel-default">            <div class="panel-body">                <div class="row">                    <div class="col-sm-9">                        {% block list_head %}                        {#                        <button id="do-function" type="button" class="btn btn-primary">执行</button>                        <button id="id-select-all" type="button" class="btn btn-primary">全选</button>                        <button id="id-search-test" type="button" class="btn btn-primary">搜索</button>                        <input type="checkbox" name="s_username" value="09876543211">09876543211</input>                        <input type="checkbox" name="s_username" value="0987654321">0987654321</input>                        #}                        {% endblock list_head %}                    </div>                    <div class="col-sm-3 dataTables_filter">                        {% block list_update -%}                        <button class="btn btn-default" type="button" id="list-update">保存</button>                        {%- endblock list_update %}                        {% block list_create -%}                        {% if not pageopts.perm_create or has_perms(request.opuser, pageopts.perm_create) %}                        <a href="{{ url(pageopts.create_url) }}" class="btn btn-primary">                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>                            新增                        </a>                        {% endif %}                        {%- endblock list_create %}                    </div>                </div>                <div class="table-responsive">                    <table class="table table-striped table-bordered table-hover" id="dataTables">                        <thead>                            <tr>                                {% block table_header -%}                                {% for item in list_fields.to_list() %}                                    <th>{{ item.title }}</th>                                {% endfor %}                                {%- endblock table_header %}                            </tr>                        </thead>                        <tbody  id="datasearch">                        </tbody>                        <tfoot>                        {% block table_foot %}                        {% endblock table_foot %}                        </tfoot>                    </table>                </div> <!-- /.dataTable_wrapper -->            </div> <!-- /.panel-body -->        </div> <!-- /.panel -->    </div> <!-- /.col-lg-12 --></div> <!-- /.row -->{% endblock list_body %}{% endblock content %}{% block jscontent %}<script src="{{ static('plugins/datatables/jquery.dataTables.min.js') }}"></script>		<!-- AdminLTE App --><script src="{{ static('plugins/datatables/dataTables.bootstrap.min.js') }}"></script><script src="{{ static('plugins/slimScroll/jquery.slimscroll.min.js') }}"></script><script src="{{ static('plugins/fastclick/fastclick.js') }}"></script><script type="text/javascript" src="{{ static('lib/js/select2.min.js') }}"></script><script src="{{ static('js/hera-list.js') }}"></script><script src="{{ static('js/hera-select2.js') }}"></script>{% block body_js %}{% block body_js_file %}{% endblock body_js_file %}<script type="text/javascript">{% if dtopts %}$(document).ready(function() {    var table = $('#dataTables').dataTable({        {% block paging_control %}        {% if has_perms(request.opuser, [dtopts.perm_show_total]) and SETTINGS.SIMPLE_PAGE %}        "dom": 'ltipr',        {% else %}        "dom": 'ltpr',        "pagingType": "simple",        {% endif %}        {% endblock paging_control %}        "language": {            "url": "{{ static('lib/js/dataTable.Chinese.json') }}"        },        "responsive": true,        "lengthChange": false,        "serverSide": true,        "ajax": {            url: "{{ dtopts.ajax.url }}",            type: "{{ dtopts.ajax.method|d('POST') }}",        },        "columns": {{ list_fields.to_json()|safe }},        "searchCols": [            {% for col in list_fields.to_list() -%}            {% if col.name in searches -%}            {{ searches[col.name]|jsonify|safe }},            {% else %}            null,            {%- endif %}            {%- endfor %}        ],        "columnDefs": [            {% block column_defs %}{% endblock column_defs %}        ],        "order": [[{{ list_fields.index(dtopts.order.name) }}, "{{ dtopts.order.dir|d('desc') }}"]],        "processing": true,        "deferRender": true,    });    $.subscribe('gm-sidebar:resized', function () {        util.resizeDataTable(table);    });    //=== search click ===    $("#id-search-btn").on("keyup click", function(){        search_click();    });});{% endif %}{% block body_js_code %}{% endblock body_js_code %}</script>{% endblock %}{% block end_js %}    <script type="text/javascript">    $(document).ready(function() {        var current_page = {{ dt_page }};        var dt = $('#dataTables').DataTable();        dt.on('draw', function(){            dt.off('draw');        dt.on('draw', function(){    $('#id-list').find('a').each(function(){    var href_content = this.href.split('?')[0];    if(this.href.indexOf('#')==-1){        //this.href = href_content + '?dt_page='+ dt.page();        this.target = "_blank";    }    });    $("#id-search-btn").off("keyup click");    $("#id-search-btn").on("keyup click", function () {        search_click();    });});        dt.page(current_page).draw( false );        });    });     </script>{% endblock %}{% endblock %}{% macro list_datetime_range(range_name, input_class='', date_format='', placeholder='', attrs=None, kwargs=None) -%}    {% if kwargs is none %}    {% set kwargs = {'min': "1900-01-01 00:00:00", 'max': "2099-12-31 23:59:59"} %}    {% elif 'min' not in kwargs %}    {% set _ = kwargs.update({'min': "1900-01-01 00:00:00"}) %}    {% elif 'max' not in kwargs %}    {% set _ = kwargs.update({'max': "2099-12-31 23:59:59"}) %}    {% endif %}    {% if attrs is none %}    {% set attrs = ["readonly"] %}    {% else %}    {% set _ = attrs.append("readonly") %}    {% endif %}    {% set name_min = range_name+'_min' %}    {% set name_max = range_name+'_max' %}<div class="col-sm-4">    <div class="form-inline">        <input class="{{ input_class }} datetime-range" type="text" id="{{ name_min }}" name="{{ name_min }}"  range_name={{ range_name }} placeholder="{{ placeholder|default(date_format, true) }}" readonly>        <span  class="fa fa-calendar fa-lg" onclick="laydate({                    elem: '#{{ name_min }}',                    format: '{{ date_format }}',                    istime: true,                    isclear: true,                    istoday: true,                    issure: true,                    festival: true,                    min: '{{ kwargs['min'] }}',                    max: '{{ kwargs['max'] }}',                    fixed: false,                    zIndex: 99999999,                    choose: function(dates){                        $('#{{ name_min }}').trigger('change');                    }                });" >        </span>    </div></div><label class="col-sm-1 control-label">------</label><div class="col-sm-4">    <div class="form-inline">        <input class="{{ input_class }} datetime-range" type="text" id="{{ name_max }}" name="{{ name_max }}" range_name={{ range_name }} placeholder="{{ placeholder|default(date_format, true) }}" readonly>        <span  class="fa fa-calendar fa-lg" onclick="laydate({                    elem: '#{{ name_max }}',                    format: '{{ date_format }}',                    istime: true,                    isclear: true,                    istoday: true,                    issure: true,                    festival: true,                    min: '{{ kwargs['min'] }}',                    max: '{{ kwargs['max'] }}',                    fixed: false,                    zIndex: 99999999,                    choose: function(dates){                        $('#{{ name_max }}').trigger('change');                    }                });" >        </span>    </div></div>{%- endmacro %}{% macro list_radio(range_name, field=None) -%}<label class="checkbox-inline">    <input type="radio" class="instant-filter flt-{{ range_name }}" name="{{ range_name }}" value="" > 所有</label>{% if field %}    {% for opt, name in field.choices %}        <label class="checkbox-inline">            <input type="radio" class="instant-filter flt-{{ range_name }}" name="{{ range_name }}"                   value="{{ opt }}"> {{ name }}        </label>    {% endfor %}{% else %}<label class="checkbox-inline">    <input type="radio" class="instant-filter flt-{{ range_name }}" name="{{ range_name }}" value="1" > 是</label><label class="checkbox-inline">    <input type="radio" class="instant-filter flt-{{ range_name }}" name="{{ range_name }}" value="0" > 否</label>{% endif %}{%- endmacro %}{% macro list_checkbox(cb_name, field) -%}<label class="checkbox-inline">    <input type="checkbox" class="instant-filter" id="flt-{{cb_name}}-all" name="{{cb_name}}" value="all"/>全部</label>{% for opt, name in field.choices %}<label class="checkbox-inline">    <input type="checkbox" class="instant-filter flt-{{cb_name}}" name="{{cb_name}}" value="{{ opt }}"/>{{ name }}</label>{% endfor %}{%- endmacro %}